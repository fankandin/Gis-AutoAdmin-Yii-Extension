<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="language" content="en"/>
	<title>Indicate point on map</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.google.com/jsapi"></script>
	<style type="text/css">
		html, body {margin: 0; padding: 0; width: 100%; height: 100%;}
		#layout {display: table; width: 100%; height: 100%;}
		#map {display: table-cell; width: 100%; height: 100%;}
	</style>
	<script type="text/javascript">
	google.load('maps', '3', {'other_params': 'sensor=false'});
	$(document).ready(function() {
		var $inputs = window.opener.$('[id="'+ document.location.hash.substr(1) +'"]').siblings('input');
		var center;
		var defCoords = false;
		if($inputs.filter('[name$="[srid]"]').val() == '4326')
		{
			var lat = $inputs.filter('[name$="[lat]"]').val();
			var lon = $inputs.filter('[name$="[lon]"]').val();
			if(lat <= 360 || Math.abs(lat) <= 180 && lon <= 360 || Math.abs(lon) <= 180)
			{
				center = new google.maps.LatLng(lat, lon);
				defCoords = true;
			}
		}
		if(!center)
			center = new google.maps.LatLng(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);
		var map = new google.maps.Map(document.getElementById('map'), {
				center: center,
				zoom: 5,
				mapTypeId: google.maps.MapTypeId['TERRAIN']
			});
		if(defCoords)
		{
			var pointOpts = {
				position: center,
				title: 'Point is now here'
			};
			var gMarker = new google.maps.Marker(pointOpts);
			gMarker.setMap(map);
		}
	});
	</script>
</head>
<body>
	<div id="layout"><div id="map"></div></div>
</body>
</html>
